<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>/Morfeo Video Club</title>
  <style>
    :root {
      --bg-color: black;
      --text-color: #0f0;
      --glitch-color: #0f0;
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      font-family: monospace;
      margin: 0;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h2 {
      margin-bottom: 1rem;
      font-size: 1.5rem;
      text-shadow: 0 0 6px var(--text-color);
    }

    #ascii {
      white-space: pre;
      font-size: 9px;
      line-height: 9px;
      padding: 1rem;
      text-shadow: 0 0 5px var(--text-color);
      animation: flicker 3s infinite ease-in-out alternate;
      transition: all 0.3s ease-in-out;
      overflow-x: auto;
      max-width: 100%;
    }

    .shadow {
      text-shadow: 2px 2px var(--glitch-color), -1px -1px var(--text-color);
    }

    #controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .control {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text-color);
      font-size: 0.8rem;
    }

    input[type=range], select {
      width: 120px;
      margin-top: 4px;
    }

    .random-check {
      margin-top: 4px;
      font-size: 0.7rem;
    }

    canvas {
      display: none;
    }

    @keyframes flicker {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }

    @keyframes glitch {
      0% { filter: none; }
      30% { filter: hue-rotate(20deg) blur(0.5px); }
      70% { filter: contrast(150%) brightness(120%); }
      100% { filter: none; }
    }
  </style>
</head>
<body>
  <h1>⎇ MORFEO VIDEO CLUB</h1>

  <div id="controls">
    <div class="control">
    </div>
    <!-- Sliders + random checkboxes -->
    <div class="control">
      <label>Ancho</label>
      <input id="widthSlider" type="range" min="50" max="200" value="100">
      <label class="random-check"><input type="checkbox" id="widthRandom"> random</label>
    </div>
    <div class="control">
      <label>Escala Y</label>
      <input id="scaleYSlider" type="range" min="0.3" max="1" step="0.05" value="0.55">
      <label class="random-check"><input type="checkbox" id="scaleYRandom"> random</label>
    </div>
    <div class="control">
      <label>Fuente</label>
      <input id="fontSizeSlider" type="range" min="6" max="16" value="9">
      <label class="random-check"><input type="checkbox" id="fontSizeRandom"> random</label>
    </div>
    <div class="control">
      <label>Glitch %</label>
      <input id="glitchSlider" type="range" min="0" max="0.1" step="0.005" value="0.01">
      <label class="random-check"><input type="checkbox" id="glitchRandom"> random</label>
    </div>
    <div class="control">
      <label>Contraste</label>
      <input id="contrastSlider" type="range" min="0.5" max="2" step="0.1" value="1">
      <label class="random-check"><input type="checkbox" id="contrastRandom"> random</label>
    </div>
    <div class="control">
      <label>Brillo</label>
      <input id="brightnessSlider" type="range" min="-100" max="100" step="10" value="0">
      <label class="random-check"><input type="checkbox" id="brightnessRandom"> random</label>
    </div>

    <!-- Extras -->
    <div class="control">
      <label>Charset</label>
      <select id="charsetSelect">
        <option value="@#W$9876543210?!abc;:+=-,._ ">Clásico</option>
        <option value="$@B%8&WM#*oahkbdpqwmZO0QL">Denso</option>
        <option value=" .:-=+*#%@">Minimal</option>
        <option value="0123456789">Numérico</option>
        <option value="☯☠★✦✧">Símbolos</option>
      </select>
    </div>
    <div class="control"><label>Invertir</label><input id="invertCheckbox" type="checkbox"></div>
    <div class="control"><label>Sombra</label><input id="shadowCheckbox" type="checkbox"></div>
    <div class="control">
      <label>Tema</label>
      <select id="themeSelect">
        <option value="matrix">Matrix</option>
        <option value="blue">Blue</option>
        <option value="pink">Pink</option>
      </select>
    </div>
  </div>

  <canvas id="source" style="display: none; margin-top: 1rem; border: 1px solid var(--text-color); background-color: rgba(255, 255, 255, 0.02);"></canvas>
  <pre id="ascii"></pre>

  <!-- Control buttons -->
  <div style="margin-top: 1rem;">
    <button onclick="playVideos()">▶️ Play</button>
    <button onclick="pauseVideos()">⏸️ Pause</button>
    <button onclick="resetVideos()">⏮️ Reset</button>
  </div>

<!-- Audio-only video -->
<video id="audio-video" src="http://localhost:8080/videos/video.mp4" crossorigin="anonymous" autoplay loop hidden></video>


  <script>
    const video = document.createElement('video');
    video.src = "http://localhost:8080/videos/video.mp4";
    video.crossOrigin = "anonymous";
    video.autoplay = true;
    video.loop = true;
    video.muted = true;
    video.play();
  
    const canvas = document.getElementById('source');
    const ctx = canvas.getContext('2d');
    const ascii = document.getElementById('ascii');
  
    function renderFrameToAscii() {
      const width = parseInt(document.getElementById('widthSlider').value) || 100;
      const scaleY = parseFloat(document.getElementById('scaleYSlider').value) || 0.55;
      const glitchChance = parseFloat(document.getElementById('glitchSlider').value) || 0.01;
      const contrast = parseFloat(document.getElementById('contrastSlider').value) || 1;
      const brightness = parseInt(document.getElementById('brightnessSlider').value) || 0;
      let chars = document.getElementById("charsetSelect").value;
      if (document.getElementById("invertCheckbox").checked) {
        chars = chars.split('').reverse().join('');
      }
  
      const fontSize = parseInt(document.getElementById('fontSizeSlider').value) || 9;
      ascii.style.fontSize = fontSize + "px";
      ascii.style.lineHeight = fontSize + "px";
      ascii.classList.toggle("shadow", document.getElementById("shadowCheckbox").checked);
  
      const w = width;
      const h = Math.floor(video.videoHeight * (w / video.videoWidth) * scaleY);
      canvas.width = w;
      canvas.height = h;
  
      ctx.drawImage(video, 0, 0, w, h);
      const imageData = ctx.getImageData(0, 0, w, h);
  
      let asciiImage = '';
      for (let y = 0; y < h; y++) {
        for (let x = 0; x < w; x++) {
          const offset = (y * w + x) * 4;
          let r = imageData.data[offset];
          let g = imageData.data[offset + 1];
          let b = imageData.data[offset + 2];
          let avg = (r + g + b) / 3;
          avg = Math.min(255, Math.max(0, (avg + brightness) * contrast));
          const charIndex = Math.floor((avg / 255) * (chars.length - 1));
          asciiImage += chars[charIndex];
        }
        asciiImage += '\n';
      }
  
      ascii.innerHTML = asciiImage
        .split('').map(char => {
          const glitch = Math.random() < glitchChance;
          if (glitch && char.trim()) {
            return `<span style="animation: glitch 0.3s infinite;">${char}</span>`;
          }
          return char === '\n' ? '<br>' : char;
        }).join('');
  
      requestAnimationFrame(renderFrameToAscii);
    }
  
    video.addEventListener('play', () => {
      requestAnimationFrame(renderFrameToAscii);
    });

    const audioVideo = document.getElementById('audio-video');

    function playVideos() {
      video.play();
      audioVideo.play();
    }

    function pauseVideos() {
      video.pause();
      audioVideo.pause();
    }

    function resetVideos() {
      video.currentTime = 0;
      audioVideo.currentTime = 0;
      playVideos();
    }

    // Asegura que ambos videos estén sincronizados al inicio
    video.addEventListener("loadedmetadata", () => {
      audioVideo.currentTime = video.currentTime;
    });

    // Intentar desbloquear audio al primer click/tap
    document.body.addEventListener("click", () => {
      audioVideo.muted = false;
      audioVideo.play();
      video.play();
    }, { once: true });
  </script>
  
</body>
</html>
